---
title: "Misc Data"
author: "jemus42"
output:
  html_document:
    fig_width: 9
    theme: spacelab
    toc: yes
---

```{r startup, echo=FALSE,message=FALSE}
library("dplyr")
library("wurstmineR")
library("networkD3")
library("DiagrammeR")

people <- wurstmineR::getActivePeople(size = "full")

ppl    <- people[c("invitedBy", "id", "color", "joinStatus", "name")] %>%
            arrange(invitedBy) %>%
            filter(!is.na(invitedBy))
```

## People as a Network of Invitations

```{r d3,echo=F}
simpleNetwork(ppl[c("id", "invitedBy")], fontSize = 14, textColour = "black", linkDistance = 200, charge = -200)
```

## Invite Tree

```{r mermaid,echo=F}
paste0(ppl$invitedBy, "-->", ppl$id, collapse = ";") %>%
           paste("graph TD", ., sep = ";") %>%
           mermaid
```

## Session Stream: 2015

```{r session_1, echo=FALSE,message=FALSE}
library(streamgraph)
sessions            <- getSessions()
playerSessions      <- getPlayerSessions(sessions, splitByDay = T)
playerSessions$year <- lubridate::year(playerSessions$joinTime)
playedPerPerson     <- getPlayedPerX(playerSessions, people = people, sumBy = "person")
playedPerPerson %>% 
  filter(lubridate::year(date) == "2015") %>%
  #streamgraph(key = "person", "timePlayed", "date", interpolate = "step", offset = "zero") %>%
  streamgraph(key = "person", "timePlayed", "date") %>%
  sg_axis_x(1, "month", "%b-%Y") %>%
  sg_colors("PuOr") %>%
  sg_legend(show=TRUE, label="Person: ")
```

## Session Stream: 2014

```{r session_2, echo=FALSE,message=FALSE}
playedPerPerson %>% 
  filter(lubridate::year(date) == "2014") %>%
  streamgraph(key = "person", "timePlayed", "date") %>%
  sg_axis_x(1, "month", "%b-%Y") %>%
  sg_colors("PuOr") %>%
  sg_legend(show=TRUE, label="Person: ")
```

## Time Series of Session Data

```{r timeSeries, echo=FALSE,message=FALSE}
library(tidyr)
library(xts)
library(dygraphs)

ptime <- spread(playedPerPerson[c("person", "timePlayed", "date")], key = "person", value = "timePlayed") %>%
           select(-date) %>%
           xts(order.by = unique(playedPerPerson$date))
ptime[is.na(ptime)] <- 0


dygraph(ptime) %>% 
  dyOptions(stackedGraph = TRUE, fillGraph = TRUE, fillAlpha = 0.4) %>%
  dyRangeSelector %>%
  dyLegend(width = 900, show = "onmouseover", showZeroValues = F) %>%
  dyAxis("y", label = "Time Active (min)") %>%
  dyHighlight(highlightCircleSize = 5,
              hideOnMouseOut = FALSE)
```

